<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FutbolX - Free PPV and More</title>
    <meta name="description" content="FutbolX - Free PPV boxing, UFC, Basketball, Football, and more available live and on-demand.">
    <meta name="keywords" content="futbolx, ppv, free ppv, boxing, ufc, basketball, football, stream, online, free">
    <meta property="og:title" content="FutbolX - Free PPV and More" />
    <meta property="og:url" content="https://your-futbolx-site.vercel.app" />
    <meta property="og:image" content="/assets/img/og-image.jpg">
    <meta name="twitter:title" content="FutbolX - Free PPV and More">
    <meta name="twitter:description" content="Free PPV boxing and other content available live and on-demand.">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="preconnect" href="https://fonts.bunny.net" crossorigin>
    <link href="https://fonts.bunny.net/css?family=kanit:100,200,300,400,500,600,700,800,900" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/css/bootstrap.min.css" integrity="sha512-Z/def5z5u2aR89OuzYcxmDJ0Bnd5V1cKqBEbvLOiUNWdg9PQeXVvXLI90SE4QOHGlfLqUnDNVAYyZi8UwUTmWQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/assets/css/main.css?v=12">
    <style>
      .error-alert { max-width: 500px; margin: 20px auto; }
      .event-card { opacity: 0; transform: translateY(50px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
      .event-card.visible { opacity: 1; transform: translateY(0); }
    </style>
  </head>
  <body>
    <!-- Top Bar -->
    <nav class="top-bar fixed-top">
      <div class="container-fluid">
        <button class="btn btn-dark d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
          <i class="fas fa-bars"></i>
        </button>
        <span class="futbolx-brand">FutbolX</span>
      </div>
    </nav>
    <!-- Left Sidebar -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
      <div class="offcanvas-header">
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav flex-column">
          <li class="nav-item"><a class="nav-link" href="/request">Request</a></li>
          <li class="nav-item"><a class="nav-link" href="/vods">VODs</a></li>
          <li class="nav-item"><a class="nav-link" href="https://discord.gg/5AMPdpckjH">Discord</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Language</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" onclick="document.cookie = 'fs_locale=en; expires=Mon, 18 Jan 2038 12:00:00 UTC; path=/';location.reload();">English</a></li>
              <li><a class="dropdown-item" href="#" onclick="document.cookie = 'fs_locale=de; expires=Mon, 18 Jan 2038 12:00:00 UTC; path=/';location.reload();">Deutsch</a></li>
              <li><a class="dropdown-item" href="#" onclick="document.cookie = 'fs_locale=es; expires=Mon, 18 Jan 2038 12:00:00 UTC; path=/';location.reload();">Espa√±ol</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="/auth/login" id="loginLink">Login</a></li>
          <li class="nav-item"><button class="nav-link btn btn-link d-none" id="logoutButton">Logout</button></li>
          <li class="nav-item">
            <button id="themeToggle" class="nav-link btn btn-link" aria-label="Toggle theme">
              <i class="fas fa-moon"></i>
            </button>
          </li>
        </ul>
      </div>
    </div>
    <!-- Main Content -->
    <div class="container-fluid main-content">
      <div class="text-center py-5 bg-dark hero-background">
        <h1 class="display-4 fw-bold">Welcome to FutbolX</h1>
        <p class="lead">Stream Free PPV Boxing, UFC, Basketball, and More - Live & On-Demand!</p>
      </div>
      <div class="container pt-2">
        <div id="errorContainer" class="d-none error-alert"></div>
        <div id="live" class="mt-4">
          <h2 class="m-0">
            Live Now <span id="liveAnimation" class="live-animation d-none"></span>
          </h2>
          <div id="livecards" class="event-grid py-3">
            <p>Loading streams...</p>
          </div>
        </div>
        <div id="football" class="mt-5 d-none">
          <h2 class="m-0">Football</h2>
          <div id="footballcards" class="event-grid py-3"></div>
        </div>
        <div id="nba" class="mt-5 d-none">
          <h2 class="m-0">NBA</h2>
          <div id="nbacards" class="event-grid py-3"></div>
        </div>
        <div id="fights" class="mt-5 d-none">
          <h2 class="m-0">Fights</h2>
          <div id="fightscards" class="event-grid py-3"></div>
        </div>
        <div id="motorsports" class="mt-5 d-none">
          <h2 class="m-0">Motorsports</h2>
          <div id="motorsportscards" class="event-grid py-3"></div>
        </div>
        <div id="nfl" class="mt-5 d-none">
          <h2 class="m-0">NFL</h2>
          <div id="nflcards" class="event-grid py-3"></div>
        </div>
        <div id="nhl" class="mt-5 d-none">
          <h2 class="m-0">NHL</h2>
          <div id="nhlcards" class="event-grid py-3"></div>
        </div>
        <div id="mlb" class="mt-5 d-none">
          <h2 class="m-0">MLB</h2>
          <div id="mlbcards" class="event-grid py-3"></div>
        </div>
        <div id="icehockey" class="mt-5 d-none">
          <h2 class="m-0">Ice Hockey</h2>
          <div id="icehockeycards" class="event-grid py-3"></div>
        </div>
        <div id="others" class="mt-5 d-none">
          <h2 class="m-0">Others</h2>
          <div id="otherscards" class="event-grid py-3"></div>
        </div>
        <footer class="container-fluid d-flex flex-column flex-lg-row justify-content-lg-between align-items-center py-2 border-top mt-5">
          <p class="mb-2 mb-lg-0 text-body-secondary text-center text-lg-start">FutbolX 2025</p>
          <ul class="nav justify-content-center justify-content-lg-end mb-0">
            <li class="nav-item"><a href="/api" class="nav-link px-2 text-body-secondary">API</a></li>
            <li class="nav-item"><a href="https://discord.gg/5AMPdpckjH" class="nav-link px-2 text-body-secondary">Discord</a></li>
            <li class="nav-item"><a href="/changelog" class="nav-link px-2 text-body-secondary">Changelog</a></li>
            <li class="nav-item"><a href="/vip" class="nav-link px-2 text-body-secondary">Donate / VIP Access</a></li>
            <li class="nav-item"><a href="/contact" class="nav-link px-2 text-body-secondary">Contact us</a></li>
          </ul>
        </footer>
      </div>
    </div>
    <script defer>
      function zeropad(num) {
        return num > 9 ? num : '0' + num;
      }
      function countdown() {
        const now = Math.floor(Date.now() / 1000);
        const countdownElements = document.querySelectorAll('[data-start]');
        countdownElements.forEach(element => {
          const startTime = parseInt(element.getAttribute('data-start'), 10);
          let timer = startTime - now;
          if (timer > 0) {
            let days = Math.floor(timer / 86400);
            let weeks = Math.floor(days / 7);
            let hours = Math.floor(timer / 3600);
            let mins = Math.floor(timer / 60);
            let secs = Math.floor(timer);
            let displayText = '';
            if (days >= 7) {
              displayText = `Starting in ${weeks} week${weeks > 1 ? 's' : ''}`;
            } else if (days >= 1) {
              displayText = `Starting in ${days} day${days > 1 ? 's' : ''}`;
            } else {
              let hh = hours - days * 24;
              let mm = mins - hours * 60;
              let ss = secs - mins * 60;
              displayText = `${zeropad(hh)}:${zeropad(mm)}:${zeropad(ss)}`;
            }
            element.innerHTML = displayText;
          } else {
            element.innerHTML = `<a href="${element.getAttribute('data-uri')}" class="btn btn-danger btn-sm watch-button" data-navigate>Watch</a>`;
            element.style.color = '#ff8280';
          }
        });
        setTimeout(countdown, 1000);
      }
      function loadContent(api) {
        console.log('Starting loadContent at', new Date().toISOString());
        const errorContainer = document.getElementById('errorContainer');
        const liveAnimation = document.getElementById('liveAnimation');
        errorContainer.className = 'd-none error-alert';
        errorContainer.innerHTML = '';
        fetch(api.baseUrl + '/stream')
          .then(res => res.ok ? res.json() : null)
          .catch(() => null)
          .then(streamData => {
            console.log('API Response:', { streamData });
            const livecards = document.getElementById('livecards');
            livecards.innerHTML = '';
            const categories = {
              football: document.getElementById('footballcards'),
              nba: document.getElementById('nbacards'),
              fights: document.getElementById('fightscards'),
              motorsports: document.getElementById('motorsportscards'),
              nfl: document.getElementById('nflcards'),
              nhl: document.getElementById('nhlcards'),
              mlb: document.getElementById('mlbcards'),
              icehockey: document.getElementById('icehockeycards'),
              others: document.getElementById('otherscards')
            };
            Object.values(categories).forEach(card => card.innerHTML = '');
            Object.keys(categories).forEach(key => document.getElementById(key).classList.add('d-none'));
            if (!streamData || !streamData.success || !Array.isArray(streamData.streams)) {
              console.warn('No valid stream data received');
              errorContainer.className = 'alert alert-danger error-alert';
              errorContainer.innerHTML = 'No streams available. Please try again later.';
              livecards.innerHTML = '<p>No streams are live right now. Check back later!</p>';
              liveAnimation.classList.add('d-none');
              return;
            }
            const allEvents = [];
            streamData.streams.forEach(categoryData => {
              if (categoryData.streams && categoryData.streams.length > 0) {
                allEvents.push(...categoryData.streams.map(stream => ({
                  ...stream,
                  always_live: categoryData.always_live || stream.always_live,
                  category: categoryData.category || 'others'
                })));
              }
            });
            let hasLiveEvents = false;
            const now = Math.floor(Date.now() / 1000);
            allEvents.forEach((stream, index) => {
              let startTime, endTime;
              try {
                startTime = new Date(stream.starts_at).getTime() / 1000;
                if (isNaN(startTime)) throw new Error('Invalid start time');
                endTime = stream.ends_at ? new Date(stream.ends_at).getTime() / 1000 : startTime + 3 * 3600; // Default 3 hours
                if (isNaN(endTime)) endTime = startTime + 3 * 3600;
              } catch (e) {
                console.warn(`Invalid time for stream ${stream.name}: ${stream.starts_at}, ${stream.ends_at}`);
                startTime = now;
                endTime = now + 3 * 3600;
              }
              let isLive = (startTime <= now && now <= endTime) || stream.always_live == 1;
              let isEnded = now > endTime;
              if (isEnded) return; // Skip ended events
              let liveBadge = isLive ? '<span class="live-badge">LIVE</span>' : '';
              let poster = stream.poster && stream.poster !== '' ? stream.poster : 'https://via.placeholder.com/285x160?text=FutbolX';
              let streamHtml = `
                <div class="event-card">
                  <a href="/live/${stream.uri_name}" class="card-link" data-navigate>
                    <div class="card bg-black">
                      ${liveBadge}
                      <img src="${poster}" class="card-img-top cover" width="285px" height="160px" alt="${stream.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/285x160?text=Image+Failed';">
                      <div class="card-body">
                        <h2 class="card-title">${stream.name}</h2>
                        <p class="card-text">
                          <span class="event-tag text-muted">${stream.tag}</span>
                          <span class="float-end">${isLive 
                            ? `<a href="/live/${stream.uri_name}" class="btn btn-danger btn-sm watch-button" data-navigate>Watch</a>` 
                            : `<span class="countdown" data-start="${startTime}" data-uri="/live/${stream.uri_name}"></span>`}</span>
                        </p>
                      </div>
                    </div>
                  </a>
                </div>`;
              const categoryKey = stream.category.toLowerCase().replace(/\s+/g, '');
              if (isLive) {
                livecards.innerHTML += streamHtml;
                hasLiveEvents = true;
              } else {
                if (categories[categoryKey]) {
                  categories[categoryKey].innerHTML += streamHtml;
                  document.getElementById(categoryKey).classList.remove('d-none');
                } else {
                  categories.others.innerHTML += streamHtml;
                  document.getElementById('others').classList.remove('d-none');
                }
              }
            });
            if (!livecards.innerHTML) {
              livecards.innerHTML = '<p>No streams are live right now. Check back later!</p>';
              liveAnimation.classList.add('d-none');
            } else {
              liveAnimation.classList.remove('d-none');
            }
            const cards = document.querySelectorAll('.event-card');
            const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                if (entry.isIntersecting) {
                  entry.target.classList.add('visible');
                  observer.unobserve(entry.target);
                }
              });
            }, { threshold: 0.1 });
            cards.forEach(card => observer.observe(card));
          })
          .catch(error => {
            console.error('API Fetch Error:', error);
            errorContainer.className = 'alert alert-danger error-alert';
            errorContainer.innerHTML = 'Failed to load streams. Please check your internet and try again.';
            document.getElementById('livecards').innerHTML = '<p>Unable to load streams. Check back later!</p>';
            liveAnimation.classList.add('d-none');
          });
      }
      function initPage() {
        try {
          // Initialize theme
          const htmlElement = document.documentElement;
          const themeToggle = document.getElementById('themeToggle');
          const currentTheme = localStorage.getItem('theme') || 'dark';
          htmlElement.setAttribute('data-bs-theme', currentTheme);
          themeToggle.innerHTML = currentTheme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
          
          // Theme toggle event
          themeToggle.addEventListener('click', () => {
            const newTheme = htmlElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
            htmlElement.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
          });

          // Offcanvas outside click
          document.addEventListener('click', function(event) {
            const offcanvas = document.getElementById('sidebarMenu');
            const toggler = document.querySelector('[data-bs-toggle="offcanvas"]');
            const isOffcanvasOpen = offcanvas.classList.contains('show');
            const clickedInsideOffcanvas = offcanvas.contains(event.target) || toggler.contains(event.target);
            if (isOffcanvasOpen && !clickedInsideOffcanvas) {
              bootstrap.Offcanvas.getInstance(offcanvas).hide();
            }
          });

          // Load content
          const api = new Api(`${window.location.origin}/api`);
          loadContent(api);
          setInterval(() => loadContent(api), 60000);
          countdown();
          checkAuthStatus(); // Initialize auth status
        } catch (error) {
          console.error('Init page error:', error);
          document.getElementById('errorContainer').className = 'alert alert-danger error-alert';
          document.getElementById('errorContainer').innerHTML = 'An error occurred while loading the page. Please refresh.';
          document.getElementById('livecards').innerHTML = '<p>Unable to load streams. Check back later!</p>';
        }
      }
      window.onload = function() {
        console.log('Window loaded at', new Date().toISOString());
        initPage();
      };
      // Handle dynamic navigation
      document.addEventListener('click', function(event) {
        const link = event.target.closest('[data-navigate]');
        if (link) {
          event.preventDefault();
          const url = link.getAttribute('href');
          history.pushState({}, '', url);
          loadPage(url);
        }
      });
      window.addEventListener('popstate', function(event) {
        loadPage(window.location.pathname);
      });
      function loadPage(url) {
        fetch(url)
          .then(response => response.text())
          .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            document.body.innerHTML = doc.body.innerHTML;
            document.title = doc.title;
            // Reinitialize scripts
            const scripts = document.createElement('script');
            scripts.textContent = `
              ${zeropad.toString()}
              ${countdown.toString()}
              ${loadContent.toString()}
              ${initPage.toString()}
              initPage();
            `;
            document.body.appendChild(scripts);
          })
          .catch(error => {
            console.error('Navigation error:', error);
            window.location.href = url; // Fallback to full reload
          });
      }
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script async src="/assets/js/api.js"></script>
    <script async src="/assets/js/auth.js"></script>
    <script defer data-domain="your-futbolx-site.vercel.app" src="https://p.vidembed.re/js/script.hash.outbound-links.pageview-props.tagged-events.js"></script>
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
  </body>
</html>
