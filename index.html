<!doctype html>
<html lang="en" data-bs-theme="dark">
  <!-- ... Head and navbar unchanged ... -->
  <body>
    <!-- ... Hero, loading overlay, error container unchanged ... -->
    <div class="container-fluid text-white">
      <div id="errorContainer" class="d-none error-alert"></div>
      <div id="live" class="mt-4">
        <div class="d-flex flex-nowrap flex-lg-row justify-content-lg-between align-content-center">
          <h2 class="m-0 justify-content-start w-100 align-content-center" data-lang="live-title">
            <span style="animation-duration:1.2s;" class="spinner-grow text-danger" role="status"></span> Live now
          </h2>
        </div>
        <div id="livecards" class="event-grid py-3"></div>
      </div>
      <div id="categories" class="mt-5"></div>
      <footer class="container-fluid d-flex flex-column flex-lg-row justify-content-lg-between align-items-center py-2 border-top mt-5">
        <!-- ... Footer unchanged ... -->
      </footer>
    </div>
    <script defer>
      // ... MockStreams, zeropad, countdown unchanged ...
      function loadContent(api) {
        document.getElementById("errorContainer").className = 'd-none error-alert';
        try {
          api.get("/streams").then(data => {
            document.getElementById("categories").innerHTML = '';
            document.getElementById("livecards").innerHTML = '';

            if (!data || !data.success || !Array.isArray(data.streams)) {
              console.warn('Invalid API response:', data);
              renderStreams(mockStreams);
              return;
            }

            renderStreams(data);
          }).catch(error => {
            console.error('API Error:', error.message, error.stack);
            document.getElementById("errorContainer").className = 'alert alert-danger error-alert';
            document.getElementById("errorContainer").innerHTML = 'Failed to load streams due to a network issue. Please check your internet and try again.';
            renderStreams(mockStreams);
          });
        } catch (err) {
          console.error('Script Error:', err.message, err.stack);
          document.getElementById("errorContainer").className = 'alert alert-danger error-alert';
          document.getElementById("errorContainer").innerHTML = 'Error loading streams. Please try again later.';
          renderStreams(mockStreams);
        } finally {
          $("#loaderSpinner").addClass('d-none');
          $("#loadingOverlay").hide();
        }
      }
      function renderStreams(data) {
        document.getElementById("errorContainer").className = 'd-none error-alert';
        if (data.streams.length >= 1) {
          data.streams.forEach(categoryData => {
            let categoryName = categoryData.category;
            let alwaysLive = categoryData.always_live;
            let streams = categoryData.streams;
            let categoryId = categoryData.id;
            let categoryHtml = `
              <div id="${categoryId}-container" class="mt-5">
                <h2 class="m-0">${categoryName}${alwaysLive == 1 ? ' <span class="badge bg-success" data-lang="category-247">24/7</span>' : ''}</h2>
                <div id="${categoryId}" class="event-grid py-3"></div>
              </div>`;
            document.getElementById("categories").innerHTML += categoryHtml;
            streams.forEach((stream, index) => {
              let startTime;
              try {
                startTime = new Date(stream.starts_at).getTime() / 1000;
                if (isNaN(startTime)) throw new Error('Invalid start time');
              } catch (e) {
                console.warn(`Invalid starts_at for stream ${stream.name}: ${stream.starts_at}`);
                startTime = Math.floor(Date.now() / 1000);
              }
              let isLive = startTime <= Math.floor(Date.now() / 1000) || categoryData.always_live == 1 || stream.always_live == 1;
              let liveBadge = isLive ? '<span class="live-badge">LIVE</span>' : '';
              let poster = stream.poster && stream.poster !== '' 
                ? stream.poster 
                : 'https://via.placeholder.com/285x160?text=No+Image';
              let streamHtml = `
                <div class="event-card" data-aos="fade-up" data-aos-delay="${index * 100}">
                  <a href="/player/${stream.uri_name}" class="card-link">
                    <div class="card bg-black text-white">
                      ${liveBadge}
                      <img src="${poster}" class="card-img-top cover" width="285px" height="160px" alt="${stream.name}" loading="lazy" onerror="this.src='https://via.placeholder.com/285x160?text=Image+Failed';">
                      <div class="card-body">
                        <h5 class="card-title">${stream.name}</h5>
                        <p class="card-text">
                          <span class="event-tag text-muted">${stream.tag}</span>
                          <span class="float-end">${isLive 
                            ? `<a href="/player/${stream.uri_name}" class="btn btn-danger btn-sm watch-button" data-lang="watch-now">Watch</a>` 
                            : `<span class="countdown" data-start="${startTime}" data-uri="/player/${stream.uri_name}"></span>`}</span>
                        </p>
                      </div>
                    </div>
                  </a>
                </div>`;
              if (isLive) {
                document.getElementById("livecards").innerHTML += streamHtml;
              } else {
                document.getElementById(categoryId).innerHTML += streamHtml;
              }
            });
            if ($(`#${categoryId}`).is(':empty')) $(`#${categoryId}-container`).remove();
          });
        } else {
          document.getElementById("livecards").innerHTML += '<p data-lang="no-streams">No streams are live right now. Scroll down to see what\'s on later.</p>';
        }
        if ($(`#livecards`).is(':empty')) {
          document.getElementById("livecards").innerHTML += '<p data-lang="no-streams">No streams are live right now. Scroll down to see what\'s on later.</p>';
        }
        updateLanguage();
      }
      window.onload = function() {
        var api = new Api(`${window.location.origin}`);
        loadContent(api);
        setInterval(() => loadContent(api), 60000);
        countdown();
        AOS.init();
        // ... Navbar, theme toggle, language, auth unchanged ...
      }
    </script>
    <!-- ... Scripts unchanged ... -->
  </body>
</html>
