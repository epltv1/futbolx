<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Futbolx - Stream Player</title>
    <meta name="description" content="Watch live and on-demand PPV streams on Futbolx.">
    <link rel="preconnect" href="https://fonts.bunny.net" crossorigin>
    <link href="https://fonts.bunny.net/css?family=kanit:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/css/bootstrap.min.css" integrity="sha512-Z/def5z5u2aR89OuzYcxmDJ0Bnd5V1cKqBEbvLOiUNWdg9PQeXVvXLI90SE4QOHGlfLqUnDNVAYyZi8UwUTmWQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/assets/css/main.css?v=48">
    <style>
      #playerContainer { width: 100%; max-width: 1280px; margin: 20px auto; padding: 0 15px; }
      #player { width: 100%; height: 720px; }
      .error-alert { max-width: 500px; margin: 20px auto; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-black">
      <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="/request" data-lang="nav-request">Request</a></li>
            <li class="nav-item"><a class="nav-link" href="https://discord.gg/5AMPdpckjH" data-lang="nav-discord">Discord</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-lang="nav-language">English</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="setLanguage('en');" data-lang="lang-english">English</a></li>
                <li><a class="dropdown-item" href="#" onclick="setLanguage('de');" data-lang="lang-german">Deutsch</a></li>
                <li><a class="dropdown-item" href="#" onclick="setLanguage('es');" data-lang="lang-spanish">Español</a></li>
                <li><a class="dropdown-item" href="#" onclick="setLanguage('fr');" data-lang="lang-french">Français</a></li>
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link" href="/auth/login" id="loginLink" data-lang="nav-login">Login</a></li>
            <li class="nav-item"><button class="nav-link btn btn-link d-none" id="logoutButton" data-lang="nav-logout">Logout</button></li>
            <li class="nav-item">
              <button id="themeToggle" class="nav-link btn btn-link" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
              </button>
            </li>
          </ul>
          <a class="navbar-brand ms-auto" href="https://futbolx.com"><img src="/assets/img/ppvwtf.png" height="30" alt="Futbolx Logo" /></a>
        </div>
      </div>
    </nav>
    <div class="container container-fluid pt-2 text-white">
      <div id="errorContainer" class="d-none error-alert"></div>
      <a href="/" class="btn btn-secondary mb-3" data-lang="back-to-streams">Back to Streams</a>
      <h2 id="playerTitle" class="mb-3">Loading...</h2>
      <div id="playerContainer">
        <div id="player"></div>
      </div>
      <div id="streamLinks" class="mt-3"></div>
      <footer class="container-fluid d-flex flex-column flex-lg-row justify-content-lg-between align-items-center py-2 border-top mt-5">
        <p class="mb-2 mb-lg-0 text-body-secondary text-center text-lg-start" data-lang="footer-text">Futbolx 2025</p>
        <ul class="nav justify-content-center justify-content-lg-end mb-0">
          <li class="nav-item"><a href="/api" class="nav-link px-2 text-body-secondary" data-lang="footer-api">API</a></li>
          <li class="nav-item"><a href="https://discord.gg/5AMPdpckjH" class="nav-link px-2 text-body-secondary" data-lang="footer-discord">Discord</a></li>
          <li class="nav-item"><a href="/changelog" class="nav-link px-2 text-body-secondary" data-lang="footer-changelog">Changelog</a></li>
          <li class="nav-item"><a href="/vip" class="nav-link px-2 text-body-secondary" data-lang="footer-donate">Donate / VIP Access</a></li>
          <li class="nav-item"><a href="/contact" class="nav-link px-2 text-body-secondary" data-lang="footer-contact">Contact us</a></li>
        </ul>
      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/playerjs@0.1.0/dist/player.min.js"></script>
    <script defer>
      function loadPlayer() {
        const uriName = window.location.pathname.split('/live/')[1];
        console.log(`Loading player for uri_name: ${uriName}`);
        const playerTitle = document.getElementById('playerTitle');
        const errorContainer = document.getElementById('errorContainer');
        const streamLinks = document.getElementById('streamLinks');
        errorContainer.className = 'd-none error-alert';

        fetch('/streams')
          .then(response => response.json())
          .then(data => {
            if (!data || !data.success || !Array.isArray(data.streams)) {
              console.error('Invalid API response:', data);
              errorContainer.className = 'alert alert-danger error-alert';
              errorContainer.innerHTML = 'Failed to load stream data.';
              return;
            }

            let streamData = null;
            data.streams.forEach(category => {
              const found = category.streams.find(stream => stream.uri_name === uriName);
              if (found) streamData = found;
            });

            if (!streamData) {
              console.error(`Stream not found for uri_name: ${uriName}`);
              errorContainer.className = 'alert alert-danger error-alert';
              errorContainer.innerHTML = 'Stream not found.';
              return;
            }

            console.log(`Stream found: ${streamData.name}, Links: ${streamData.links.length}`);
            playerTitle.innerHTML = streamData.name;
            streamLinks.innerHTML = streamData.links.map((link, index) => `
              <button class="btn btn-${index === 0 ? 'primary' : 'secondary'} mx-1 stream-link" data-url="${link.url}">${link.title}</button>
            `).join('');

            const player = new playerjs.Player('player');
            player.on('ready', () => {
              player.setVolume(100);
              player.play();
            });
            player.src(streamData.links[0].url);

            document.querySelectorAll('.stream-link').forEach(button => {
              button.addEventListener('click', () => {
                document.querySelectorAll('.stream-link').forEach(btn => btn.classList.remove('btn-primary'));
                button.className = 'btn btn-primary mx-1 stream-link';
                player.src(button.getAttribute('data-url'));
                player.play();
              });
            });
          })
          .catch(error => {
            console.error('Fetch Error:', error.message);
            errorContainer.className = 'alert alert-danger error-alert';
            errorContainer.innerHTML = 'Failed to load stream. Please try again.';
          });
      }

      window.onload = function() {
        loadPlayer();
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        const currentTheme = localStorage.getItem('theme') || 'dark';
        htmlElement.setAttribute('data-bs-theme', currentTheme);
        themeToggle.innerHTML = currentTheme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        themeToggle.addEventListener('click', () => {
          const newTheme = htmlElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
          htmlElement.setAttribute('data-bs-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        });

        document.addEventListener('click', function(event) {
          const navbarCollapse = document.getElementById('navbarSupportedContent');
          const navbarToggler = document.querySelector('.navbar-toggler');
          const isNavbarOpen = navbarCollapse.classList.contains('show');
          const clickedInsideNavbar = navbarCollapse.contains(event.target) || navbarToggler.contains(event.target);
          if (isNavbarOpen && !clickedInsideNavbar) {
            bootstrap.Collapse.getInstance(navbarCollapse).hide();
          }
        });

        updateLanguage();
        checkAuthStatus();
      };
    </script>
    <script async src="/assets/js/api.js"></script>
    <script async src="/assets/js/lang.js"></script>
    <script async src="/assets/js/auth.js"></script>
    <script defer src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script defer data-domain="futbolx.com" src="https://p.vidembed.re/js/script.hash.outbound-links.pageview-props.tagged-events.js"></script>
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
  </body>
</html>
